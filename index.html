<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Produtos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
    }
    .toolbar, .filters, .table-container, .details {
      margin: 10px;
      background: #ffffff;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .toolbar button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      margin-right: 5px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s, transform 0.3s;
    }
    .toolbar button:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }
    .filters {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      align-items: center;
    }
    .filters label {
      display: flex;
      flex-direction: column;
      font-weight: bold;
      color: #333;
    }
    .filters select, .filters input, .details input {
      margin: 5px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    .filters select:focus, .filters input:focus {
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }
    .filters button {
      grid-column: span 2;
      align-self: center;
      justify-self: center;
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s, transform 0.3s;
    }
    .filters button:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      cursor: pointer;
      white-space: nowrap; /* Ensure table cells do not wrap */
    }
    th {
      white-space: nowrap; /* Ensure column headers do not wrap */
    }
    .selected {
      background-color: #cce5ff;
    }
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
      gap: 10px;
    }
    .pagination span {
      font-size: 18px;
      font-weight: bold;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
      padding-top: 60px;
    }
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
    .modal-content form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .modal-content form label {
      display: flex;
      flex-direction: column;
      font-weight: bold;
      color: #333;
    }
    .modal-content form input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      transition: border-color 0.3s, box-shadow 0.3s;
      text-transform: uppercase;
    }
    .modal-content form input:focus {
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }
    .modal-content form button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s, transform 0.3s;
    }
    .modal-content form button:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }
    .modal-content button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s, transform 0.3s;
    }
    .modal-content button:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }
    .dark-mode {
      background-color: #121212;
      color: #ffffff;
    }
    .dark-mode .toolbar, .dark-mode .filters, .dark-mode .table-container, .dark-mode .details {
      background: #1e1e1e;
      box-shadow: 0 0 5px rgba(255, 255, 255, 0.1);
    }
    .dark-mode table, .dark-mode th, .dark-mode td {
      border-color: #444;
      color: #ffffff;
    }
    .dark-mode .selected {
      background-color: #0056b3;
    }
    .dark-mode .modal-content {
      background-color: #2e2e2e;
      border-color: #555;
      color: #ffffff;
    }
    .dark-mode .modal-content label {
      color: #ffffff;
    }
    .dark-mode .filters label {
      color: #ffffff;
    }
    .dark-mode .close {
      color: #ccc;
    }
    .dark-mode .close:hover,
    .dark-mode .close:focus {
      color: #fff;
    }
    .dark-mode button {
      background-color: #444;
      color: #fff;
    }
    .dark-mode button:hover {
      background-color: #666;
    }
    .dark-mode input, .dark-mode select {
      background-color: #333;
      color: #fff;
      border-color: #555;
    }
    .dark-mode input:focus, .dark-mode select:focus {
      border-color: #888;
      box-shadow: 0 0 5px rgba(136, 136, 136, 0.5);
    }
    .dark-mode .pagination button {
      background-color: #444;
      color: #fff;
    }
    .dark-mode .pagination button:hover {
      background-color: #666;
    }
    .dark-mode-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 24px;
      color: #333;
      transition: color 0.3s;
    }
    .dark-mode-toggle:hover {
      color: #000;
    }
    .pagination button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s, transform 0.3s;
      margin: 0 5px;
    }
    .pagination button:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }
    .history-modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
      padding-top: 60px;
    }
    .history-modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }
    .history-modal-content table {
      width: 100%;
      border-collapse: collapse;
    }
    .history-modal-content th, .history-modal-content td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .history-modal-content .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .history-modal-content .close:hover,
    .history-modal-content .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropbtn {
      background-color: transparent;
      border: none;
      cursor: pointer;
      font-size: 24px;
      color: #007bff;
      transition: color 0.3s;
    }

    .dropbtn:hover {
      color: #0056b3;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      padding: 12px 16px;
      z-index: 1;
      border-radius: 5px;
    }

    .dropdown-content label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
      transition: color 0.3s, transform 0.3s;
      white-space: nowrap; /* Ensure labels occupy only one line */
    }

    .dropdown-content input {
      margin-right: 10px;
    }

    .dropdown-content label:hover {
      background-color: #f1f1f1;
      color: #007bff;
      transform: scale(1.05);
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    .dark-mode .dropdown-content {
      background-color: #333;
      color: #fff;
    }

    .dark-mode .dropdown-content label {
      color: #fff;
    }

    .dark-mode .dropdown-content label:hover {
      background-color: #444;
      color: #007bff;
    }
    .dark-mode .history-modal-content {
      background-color: #2e2e2e;
      border-color: #555;
      color: #ffffff;
    }

    .dark-mode .history-modal-content th, .dark-mode .history-modal-content td {
      border-color: #444;
      color: #ffffff;
    }

    .dark-mode .history-modal-content .close {
      color: #ccc;
    }

    .dark-mode .history-modal-content .close:hover,
    .dark-mode .history-modal-content .close:focus {
      color: #fff;
    }
    @media (max-width: 768px) {
      .filters {
        grid-template-columns: 1fr;
      }
      .filters label {
        margin-bottom: 10px;
      }
      .filters button {
        grid-column: span 1;
      }
      .toolbar {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
      .toolbar button {
        margin-bottom: 10px;
      }
      .table-container table, .table-container th, .table-container td {
        font-size: 12px;
      }
      .details {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .details label {
        width: 100%;
      }
      .modal-content form {
        grid-template-columns: 1fr;
      }
      .modal-content form label {
        width: 100%;
      }
      .pagination {
        flex-direction: column;
      }
      .pagination button {
        margin: 5px 0;
      }
    }
    .table-container {
      overflow-x: auto;
    }
    .tabs {
      display: flex;
      flex-direction: column;
    }
    .tab {
      display: none;
    }
    .tab.active {
      display: block;
    }
    .tab-buttons {
      display: flex;
      justify-content: space-between; /* Align horizontally with uniform spacing */
      margin-bottom: 10px;
    }
    .tab-buttons button {
      background-color: #e0e0e0; /* Softer color */
      color: #333;
      border: none;
      padding: 5px 10px; /* Smaller padding */
      cursor: pointer;
      border-radius: 3px; /* Smaller border radius */
      font-size: 12px; /* Smaller font size */
      transition: background-color 0.3s, transform 0.3s;
      margin: 0 5px; /* Uniform spacing */
    }
    .tab-buttons button:hover {
      background-color: #c0c0c0;
      transform: scale(1.05);
    }
    .dark-mode .tab-buttons button {
      background-color: #444;
      color: #fff;
    }
    .dark-mode .tab-buttons button:hover {
      background-color: #666;
    }
  </style>
</head>
<body>
  <button class="dark-mode-toggle" onclick="toggleDarkMode()">🌙</button>
<div class="toolbar">
  <button onclick="limparBusca()">Limpar Filtros</button>
  <button onclick="exportarExcel()">Exportar para Excel</button>
  <button onclick="importarExcel()">Importar Excel</button>
  <button onclick="alterarProduto()">Alterar</button>
  <button onclick="abrirModalAdicionar()">Adicionar Produto</button>
  <button onclick="abrirModalExcluir()">Excluir Produto</button>
  <button onclick="abrirModalHistorico()">Histórico de Alterações</button>
</div>

<div class="filters">
  <label>Marca:
    <select><option>&lt;Todos&gt;</option></select>
  </label>
  <label>Tipo:
    <select id="selectTipo">
      <option>&lt;Todos&gt;</option>
      <option>Consumo</option>
      <option>Aeronautico</option>
    </select>
  </label>
  <label>Situação:
    <select>
      <option>Ativos</option>
      <option>Inativos</option>
    </select>
  </label>
  <label>Buscar por:
    <select id="selectBusca">
      <option value="codBarra">COD DE BARRA</option>
      <option value="codFabric">COD DE FABRICANTE</option>
      <option value="codAuxiliar">COD AUXILIAR</option>
      <option value="descricao">DESCRIÇÃO</option>
    </select>
  </label>
  <label>Cód. Fabricante / Descrição:
    <input type="text" id="inputBusca" placeholder="Digite o código ou descrição">
  </label>
  <button onclick="limparResultados()">Limpar Resultados</button>
  <button onclick="pesquisar()">Pesquisar</button>
</div>

<div class="dropdown">
  <button class="dropbtn">☰</button>
  <div class="dropdown-content" id="dropdown-content">
    <div class="tabs">
      <div class="tab-buttons">
        <button onclick="showTab('tab1')">Dados Gerais</button>
        <button onclick="showTab('tab2')">Estoque/Compra</button>
        <button onclick="showTab('tab3')">Financeiro/Promoção</button>
        <button onclick="showTab('tab4')">Fiscais e Outros</button>
      </div>
      <div id="tab1" class="tab active">
        <label><input type="checkbox" id="colCodBarra" checked> COD BARRA</label>
        <label><input type="checkbox" id="colCodFabric" checked> COD FABRIC</label>
        <label><input type="checkbox" id="colDun14" checked> DUN14</label>
        <label><input type="checkbox" id="colDescricao" checked> DESCRIÇÃO</label>
        <label><input type="checkbox" id="colUn" checked> UN</label>
        <label><input type="checkbox" id="colMarca" checked> MARCA</label>
        <label><input type="checkbox" id="colComplemento" checked> COMPLEMENTO</label>
        <label><input type="checkbox" id="colGrupo" checked> GRUPO</label>
        <label><input type="checkbox" id="colSubgrupo" checked> SUBGRUPO</label>
        <label><input type="checkbox" id="colDescricaoCompra" checked> DESCRIÇÃO PARA COMPRA</label>
        <label><input type="checkbox" id="colTemEquiv" checked> TEM EQUIV</label>
        <label><input type="checkbox" id="colInativo" checked> INATIVO</label>
        <label><input type="checkbox" id="colLetra" checked> LETRA</label>
        <label><input type="checkbox" id="colCategoria" checked> CATEGORIA</label>
        <label><input type="checkbox" id="colCor" checked> COR</label>
        <label><input type="checkbox" id="colABC" checked> ABC</label>
        <label><input type="checkbox" id="colCodProduto" checked> COD PRODUTO</label>
        <label><input type="checkbox" id="colObservacao" checked> OBSERVAÇÃO</label>
        <label><input type="checkbox" id="colUrlEcommerce" checked> URL ECOMMERCE</label>
        <label><input type="checkbox" id="colInfoProduto" checked> INFORMAÇÕES DO PRODUTO</label>
        <label><input type="checkbox" id="colProdutoSimilar" checked> PRODUTO SIMILAR</label>
      </div>
      <div id="tab2" class="tab">
        <label><input type="checkbox" id="colEstoqueReservado" checked> ESTOQUE RESERVADO</label>
        <label><input type="checkbox" id="colDisponivel" checked> DISPONÍVEL</label>
        <label><input type="checkbox" id="colQtdeCompra" checked> QTDE COMPRA</label>
        <label><input type="checkbox" id="colEstoqueSeg" checked> ESTOQUE SEG</label>
        <label><input type="checkbox" id="colEstoqueMin" checked> ESTOQUE MIN</label>
        <label><input type="checkbox" id="colDtUltAlteracao" checked> DT ULT ALTERAÇÃO</label>
      </div>
      <div id="tab3" class="tab">
        <label><input type="checkbox" id="colPreco" checked> R$ PREÇO</label>
        <label><input type="checkbox" id="colComAVista" checked> COM.A VISTA</label>
        <label><input type="checkbox" id="colComAPrazo" checked> COM.A PRAZO</label>
        <label><input type="checkbox" id="colDtInicioProm" checked> DT INICIO PROM</label>
        <label><input type="checkbox" id="colDtFimProm" checked> DT FIM PROM</label>
        <label><input type="checkbox" id="colPesoBruto" checked> PESO BRUTO</label>
        <label><input type="checkbox" id="colPromocao" checked> PROMOÇÃO</label>
        <label><input type="checkbox" id="colSuspenso" checked> SUSPENSO</label>
        <label><input type="checkbox" id="colCustoTotal" checked> CUSTO TOTAL</label>
        <label><input type="checkbox" id="colCustoMedio" checked> CUSTO MÉDIO</label>
        <label><input type="checkbox" id="colCustoProducao" checked> CUSTO PRODUÇÃO</label>
        <label><input type="checkbox" id="colValorFrete" checked> VALOR FRETE</label>
      </div>
      <div id="tab4" class="tab">
        <label><input type="checkbox" id="colCFiscal" checked> C. FISCAL</label>
        <label><input type="checkbox" id="colClassFiscal" checked> CLASS.FISCAL</label>
        <label><input type="checkbox" id="colDtCadastro" checked> DT CADASTRO</label>
        <label><input type="checkbox" id="colCST" checked> CST</label>
        <label><input type="checkbox" id="colGrupoImpostos" checked> GRUPO IMPOSTOS</label>
        <label><input type="checkbox" id="colTipo" checked> TIPO</label>
        <label><input type="checkbox" id="colLargura" checked> LARGURA</label>
        <label><input type="checkbox" id="colAltura" checked> ALTURA</label>
        <label><input type="checkbox" id="colComprimento" checked> COMPRIMENTO</label>
        <label><input type="checkbox" id="colTamanho" checked> TAMANHO</label>
        <label><input type="checkbox" id="colPesoLiquido" checked> PESO LIQUIDO</label>
        <label><input type="checkbox" id="colGrupoTributo" checked> GRUPO TRIBUTO</label>
        <label><input type="checkbox" id="colIPI" checked> IPI</label>
        <label><input type="checkbox" id="colGarantiaDias" checked> GARANTIA (DIAS)</label>
        <label><input type="checkbox" id="colSetor" checked> SETOR</label>
        <label><input type="checkbox" id="colCodCest" checked> COD CEST</label>
        <label><input type="checkbox" id="colCodBeneficio" checked> CÓD. BENEFÍCIO</label>
      </div>
    </div>
  </div>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th class="colCodBarra">COD BARRA</th>
        <th class="colCodFabric">COD FABRIC</th>
        <th class="colDun14">DUN14</th>
        <th class="colDescricao">DESCRIÇÃO</th>
        <th class="colUn">UN</th>
        <th class="colMarca">MARCA</th>
        <th class="colEstoqueReservado">ESTOQUE RESERVADO</th>
        <th class="colDisponivel">DISPONÍVEL</th>
        <th class="colPreco">R$ PREÇO</th>
        <th class="colQtdeCompra">QTDE COMPRA</th>
        <th class="colDtInicioProm">DT INICIO PROM</th>
        <th class="colDtFimProm">DT FIM PROM</th>
        <th class="colPesoBruto">PESO BRUTO</th>
        <th class="colPromocao">PROMOÇÃO</th>
        <th class="colSuspenso">SUSPENSO</th>
        <th class="colComAVista">COM.A VISTA</th>
        <th class="colComAPrazo">COM.A PRAZO</th>
        <th class="colComplemento">COMPLEMENTO</th>
        <th class="colGrupo">GRUPO</th>
        <th class="colSubgrupo">SUBGRUPO</th>
        <th class="colDescricaoCompra">DESCRIÇÃO PARA COMPRA</th>
        <th class="colTemEquiv">TEM EQUIV</th>
        <th class="colInativo">INATIVO</th>
        <th class="colLetra">LETRA</th>
        <th class="colCFiscal">C. FISCAL</th>
        <th class="colClassFiscal">CLASS.FISCAL</th>
        <th class="colDtCadastro">DT CADASTRO</th>
        <th class="colCategoria">CATEGORIA</th>
        <th class="colCor">COR</th>
        <th class="colABC">ABC</th>
        <th class="colCodProduto">COD PRODUTO</th>
        <th class="colCST">CST</th>
        <th class="colEstoqueSeg">ESTOQUE SEG</th>
        <th class="colEstoqueMin">ESTOQUE MIN</th>
        <th class="colDtUltAlteracao">DT ULT ALTERAÇÃO</th>
        <th class="colGrupoImpostos">GRUPO IMPOSTOS</th>
        <th class="colTipo">TIPO</th>
        <th class="colObservacao">OBSERVAÇÃO</th>
        <th class="colLargura">LARGURA</th>
        <th class="colAltura">ALTURA</th>
        <th class="colComprimento">COMPRIMENTO</th>
        <th class="colTamanho">TAMANHO</th>
        <th class="colPesoLiquido">PESO LIQUIDO</th>
        <th class="colGrupoTributo">GRUPO TRIBUTO</th>
        <th class="colIPI">IPI</th>
        <th class="colGarantiaDias">GARANTIA (DIAS)</th>
        <th class="colSetor">SETOR</th>
        <th class="colCustoTotal">CUSTO TOTAL</th>
        <th class="colCustoMedio">CUSTO MÉDIO</th>
        <th class="colCustoProducao">CUSTO PRODUÇÃO</th>
        <th class="colUrlEcommerce">URL ECOMMERCE</th>
        <th class="colInfoProduto">INFORMAÇÕES DO PRODUTO</th>
        <th class="colProdutoSimilar">PRODUTO SIMILAR</th>
        <th class="colCodCest">COD CEST</th>
        <th class="colValorFrete">VALOR FRETE</th>
        <th class="colCodBeneficio">CÓD. BENEFÍCIO</th>
      </tr>
    </thead>
    <tbody id="tabela-produtos">
      <!-- Itens aparecem aqui após busca -->
    </tbody>
  </table>
</div>

<div class="pagination">
  <button onclick="paginaAnterior()">Anterior</button>
  <span id="paginaAtual">1</span> de <span id="totalPaginas">1</span>
  <button onclick="proximaPagina()">Próxima</button>
</div>

<div class="details">
  <label>Disponível: <input type="number" id="inputDisponivel" value="0"></label>
  <button onclick="aplicarAlteracao()">Aplicar Alterações</button>
</div>

<div id="modalDetalhes" class="modal">
  <div class="modal-content">
    <span class="close" onclick="fecharModal()">&times;</span>
    <h2>Detalhes do Produto</h2>
    <form>
      <label>Nome: <input type="text" id="inputNome"></label>
      <label>Quantidade: <input type="number" id="inputQuantidade"></label>
      <label>Grupo: <input type="text" id="inputGrupo"></label>
      <label>Subgrupo: <input type="text" id="inputSubgrupo"></label>
      <label>Categoria: <input type="text" id="inputCategoria"></label>
      <label>Unidade:
        <select id="inputUnidade">
          <option value="UN">UN</option>
          <option value="KG">KG</option>
          <option value="GR">GR</option>
          <option value="FT">FT</option>
          <option value="CM">CM</option>
          <option value="M">M</option>
          <option value="LT">LT</option>
          <option value="M2">M2</option>
        </select>
      </label>
      <label>Preço:
        <select id="inputPrecoDetalhes">
          <option value="R$">R$</option>
          <option value="US$">US$</option>
          <option value="€">€</option>
        </select>
      </label>
      <label>Serial Number: <input type="text" id="inputSerialNumber"></label>
      <button type="button" onclick="salvarAlteracoes()">Salvar Alterações</button>
    </form>
  </div>
</div>

<div id="modalAdicionar" class="modal">
  <div class="modal-content">
    <span class="close" onclick="fecharModalAdicionar()">&times;</span>
    <h2>Adicionar Produto</h2>
    <form>
      <label>Cod Barra: <input type="text" id="inputCodBarra"></label>
      <label>Cod Fabricante: <input type="text" id="inputCodFabric"></label>
      <label>Cod Auxiliar: <input type="text" id="inputCodAuxiliar"></label>
      <label>Descrição: <input type="text" id="inputDescricao"></label>
      <label>Unidade:
        <select id="inputUnidadeAdicionar">
          <option value="UN">UN</option>
          <option value="KG">KG</option>
          <option value="GR">GR</option>
          <option value="FT">FT</option>
          <option value="CM">CM</option>
          <option value="M">M</option>
          <option value="LT">LT</option>
          <option value="M2">M2</option>
        </select>
      </label>
      <label>Disponível: <input type="text" id="inputDisponivelAdicionar"></label>
      <label>Preço:
        <select id="inputPreco">
          <option value="R$">R$</option>
          <option value="US$">US$</option>
          <option value="€">€</option>
        </select>
      </label>
      <label>Serial Number: <input type="text" id="inputSerialNumberAdicionar"></label>
      <label>Grupo: <input type="text" id="inputGrupoAdicionar"></label>
      <label>Subgrupo: <input type="text" id="inputSubgrupoAdicionar"></label>
      <label>Categoria: <input type="text" id="inputCategoriaAdicionar"></label>
      <button type="button" onclick="adicionarProduto()">Adicionar</button>
    </form>
  </div>
</div>

<div id="modalExcluir" class="modal">
  <div class="modal-content">
    <span class="close" onclick="fecharModalExcluir()">&times;</span>
    <h2>Excluir Produto</h2>
    <p>Tem certeza que deseja excluir este produto?</p>
    <button onclick="confirmarExclusao()">Sim</button>
    <button onclick="fecharModalExcluir()">Não</button>
  </div>
</div>

<div id="modalHistorico" class="history-modal">
  <div class="history-modal-content">
    <span class="close" onclick="fecharModalHistorico()">&times;</span>
    <h2>Histórico de Alterações</h2>
    <table>
      <thead>
        <tr>
          <th>Usuário</th>
          <th>Alteração</th>
          <th>Data</th>
          <th>Hora</th>
        </tr>
      </thead>
      <tbody id="tabela-historico">
        <!-- Histórico de alterações aparece aqui -->
      </tbody>
    </table>
  </div>
</div>

<script>
  const produtos = [];
  let produtosSelecionados = [];
  let produtosFiltrados = [...produtos];
  let pagina = 1;
  const itensPorPagina = 10;
  const historicoAlteracoes = [];

  document.addEventListener('keydown', function(event) {
    if (event.ctrlKey && event.key === 'a') {
      event.preventDefault();
      selecionarTodosProdutos();
    }
  });

  function selecionarTodosProdutos() {
    produtosSelecionados = [...produtosFiltrados];
    document.querySelectorAll('.table-container tr').forEach(linha => linha.classList.add('selected'));
  }

  function pesquisar() {
    const valorBusca = document.getElementById('inputBusca').value.trim().toUpperCase();
    const tipoBusca = document.getElementById('selectBusca').value;
    const tipoFiltro = document.getElementById('selectTipo').value;

    produtosFiltrados = produtos.filter(produto =>
      (produto[tipoBusca].toString().toUpperCase().includes(valorBusca)) &&
      (tipoFiltro === '<Todos>' || produto.categoria === tipoFiltro)
    );

    pagina = 1;
    renderizarTabela();
  }

  function renderizarTabela() {
    const tabela = document.getElementById('tabela-produtos');
    tabela.innerHTML = '';
    const inicio = (pagina - 1) * itensPorPagina;
    const fim = inicio + itensPorPagina;
    const paginaProdutos = produtosFiltrados.slice(inicio, fim);

    if (paginaProdutos.length === 0) {
      tabela.innerHTML = '<tr><td colspan="58">Nenhum item encontrado</td></tr>';
      return;
    }

    paginaProdutos.forEach(produto => {
      const linha = document.createElement('tr');
      linha.innerHTML = `
        <td class="colCodBarra">${produto.codBarra}</td>
        <td class="colCodFabric">${produto.codFabric}</td>
        <td class="colDun14">${produto.dun14}</td>
        <td class="colDescricao">${produto.descricao}</td>
        <td class="colUn">${produto.un}</td>
        <td class="colMarca">${produto.marca}</td>
        <td class="colEstoqueReservado">${produto.estoqueReservado}</td>
        <td class="colDisponivel">${produto.disponivel}</td>
        <td class="colPreco">${produto.preco}</td>
        <td class="colQtdeCompra">${produto.qtdeCompra}</td>
        <td class="colDtInicioProm">${produto.dtInicioProm}</td>
        <td class="colDtFimProm">${produto.dtFimProm}</td>
        <td class="colPesoBruto">${produto.pesoBruto}</td>
        <td class="colPromocao">${produto.promocao}</td>
        <td class="colSuspenso">${produto.suspenso}</td>
        <td class="colComAVista">${produto.comAVista}</td>
        <td class="colComAPrazo">${produto.comAPrazo}</td>
        <td class="colComplemento">${produto.complemento}</td>
        <td class="colGrupo">${produto.grupo}</td>
        <td class="colSubgrupo">${produto.subgrupo}</td>
        <td class="colDescricaoCompra">${produto.descricaoCompra}</td>
        <td class="colTemEquiv">${produto.temEquiv}</td>
        <td class="colInativo">${produto.inativo}</td>
        <td class="colLetra">${produto.letra}</td>
        <td class="colCFiscal">${produto.cFiscal}</td>
        <td class="colClassFiscal">${produto.classFiscal}</td>
        <td class="colDtCadastro">${produto.dtCadastro}</td>
        <td class="colCategoria">${produto.categoria}</td>
        <td class="colCor">${produto.cor}</td>
        <td class="colABC">${produto.abc}</td>
        <td class="colCodProduto">${produto.codProduto}</td>
        <td class="colCST">${produto.cst}</td>
        <td class="colEstoqueSeg">${produto.estoqueSeg}</td>
        <td class="colEstoqueMin">${produto.estoqueMin}</td>
        <td class="colDtUltAlteracao">${produto.dtUltAlteracao}</td>
        <td class="colGrupoImpostos">${produto.grupoImpostos}</td>
        <td class="colTipo">${produto.tipo}</td>
        <td class="colObservacao">${produto.observacao}</td>
        <td class="colLargura">${produto.largura}</td>
        <td class="colAltura">${produto.altura}</td>
        <td class="colComprimento">${produto.comprimento}</td>
        <td class="colTamanho">${produto.tamanho}</td>
        <td class="colPesoLiquido">${produto.pesoLiquido}</td>
        <td class="colGrupoTributo">${produto.grupoTributo}</td>
        <td class="colIPI">${produto.ipi}</td>
        <td class="colGarantiaDias">${produto.garantiaDias}</td>
        <td class="colSetor">${produto.setor}</td>
        <td class="colCustoTotal">${produto.custoTotal}</td>
        <td class="colCustoMedio">${produto.custoMedio}</td>
        <td class="colCustoProducao">${produto.custoProducao}</td>
        <td class="colUrlEcommerce">${produto.urlEcommerce}</td>
        <td class="colInfoProduto">${produto.infoProduto}</td>
        <td class="colProdutoSimilar">${produto.produtoSimilar}</td>
        <td class="colCodCest">${produto.codCest}</td>
        <td class="colValorFrete">${produto.valorFrete}</td>
        <td class="colCodBeneficio">${produto.codBeneficio}</td>
      `;
      linha.onclick = (event) => selecionarProduto(produto, linha, event);
      abrirAlteracaoAoClicarDuasVezes(produto, linha);
      tabela.appendChild(linha);
    });

    document.getElementById('paginaAtual').textContent = pagina;
    document.getElementById('totalPaginas').textContent = Math.ceil(produtosFiltrados.length / itensPorPagina);
    atualizarVisibilidadeColunas();
  }

  function atualizarVisibilidadeColunas() {
    const checkboxes = document.querySelectorAll('.dropdown-content input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
      const colunaClass = checkbox.id.replace('col', 'col');
      const elementos = document.querySelectorAll(`.${colunaClass}`);
      elementos.forEach(elemento => {
        elemento.style.display = checkbox.checked ? '' : 'none';
      });
    });
  }

  document.querySelectorAll('.dropdown-content input[type="checkbox"]').forEach(checkbox => {
    checkbox.addEventListener('change', atualizarVisibilidadeColunas);
  });

  document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('dropdown-content');
    if (!event.target.closest('.dropdown')) {
      dropdown.style.display = 'none';
    }
  });

  document.querySelector('.dropbtn').addEventListener('click', function(event) {
    const dropdown = document.getElementById('dropdown-content');
    dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    event.stopPropagation();
  });

  document.getElementById('dropdown-content').addEventListener('click', function(event) {
    event.stopPropagation();
  });

  function selecionarProduto(produto, linha, event) {
    if (event.ctrlKey) {
      if (produtosSelecionados.includes(produto)) {
        produtosSelecionados = produtosSelecionados.filter(p => p !== produto);
        linha.classList.remove('selected');
      } else {
        produtosSelecionados.push(produto);
        linha.classList.add('selected');
      }
    } else {
      produtosSelecionados = [produto];
      document.querySelectorAll('.table-container tr').forEach(linha => linha.classList.remove('selected'));
      linha.classList.add('selected');
    }
  }

  function abrirAlteracaoAoClicarDuasVezes(produto, linha) {
    linha.ondblclick = () => {
      produtosSelecionados = [produto];
      alterarProduto();
    };
  }

  function paginaAnterior() {
    if (pagina > 1) {
      pagina--;
      renderizarTabela();
    }
  }

  function proximaPagina() {
    if (pagina * itensPorPagina < produtosFiltrados.length) {
      pagina++;
      renderizarTabela();
    }
  }

  function fecharModal() {
    document.getElementById('modalDetalhes').style.display = 'none';
  }

  function aplicarAlteracao() {
    if (produtosSelecionados.length > 0) {
      const novoValor = parseInt(document.getElementById('inputDisponivel').value, 10);
      produtosSelecionados.forEach(produto => {
        const alteracao = {
          usuario: 'Usuário Atual', // Substitua pelo nome do usuário atual
          alteracao: `Alterou disponível de ${produto.disponivel} para ${isNaN(novoValor) ? 0 : novoValor}`,
          data: new Date().toLocaleDateString(),
          hora: new Date().toLocaleTimeString()
        };
        historicoAlteracoes.push(alteracao);
        produto.disponivel = isNaN(novoValor) ? 0 : novoValor;
      });
      pesquisar();
      alert('Alteração aplicada com sucesso!');
    }
  }

  function limparResultados() {
    document.getElementById('tabela-produtos').innerHTML = '';
  }

  function limparBusca() {
    document.getElementById('inputBusca').value = '';
    limparResultados();
  }

  function exportarExcel() {
    if (produtos.length === 0) {
      alert('Nenhum produto para exportar.');
      return;
    }

    const worksheet = XLSX.utils.json_to_sheet(produtos.map(produto => ({
      'COD BARRA': produto.codBarra,
      'COD FABRIC': produto.codFabric,
      'DUN14': produto.dun14,
      'DESCRIÇÃO': produto.descricao,
      'UN': produto.un,
      'ESTOQUE RESERVADO': produto.estoqueReservado,
      'DISPONÍVEL': produto.disponivel,
      'R$ PREÇO': produto.preco,
      'QTDE COMPRA': produto.qtdeCompra,
      'DT INICIO PROM': produto.dtInicioProm,
      'DT FIM PROM': produto.dtFimProm,
      'PESO BRUTO': produto.pesoBruto,
      'PROMOÇÃO': produto.promocao,
      'SUSPENSO': produto.suspenso,
      'COM.A VISTA': produto.comAVista,
      'COM.A PRAZO': produto.comAPrazo,
      'COMPLEMENTO': produto.complemento,
      'GRUPO': produto.grupo,
      'SUBGRUPO': produto.subgrupo,
      'DESCRIÇÃO PARA COMPRA': produto.descricaoCompra,
      'TEM EQUIV': produto.temEquiv,
      'INATIVO': produto.inativo,
      'LETRA': produto.letra,
      'C. FISCAL': produto.cFiscal,
      'CLASS.FISCAL': produto.classFiscal,
      'DT CADASTRO': produto.dtCadastro,
      'CATEGORIA': produto.categoria,
      'COR': produto.cor,
      'ABC': produto.abc,
      'COD PRODUTO': produto.codProduto,
      'CST': produto.cst,
      'ESTOQUE SEG': produto.estoqueSeg,
      'ESTOQUE MIN': produto.estoqueMin,
      'DT ULT ALTERAÇÃO': produto.dtUltAlteracao,
      'GRUPO IMPOSTOS': produto.grupoImpostos,
      'TIPO': produto.tipo,
      'OBSERVAÇÃO': produto.observacao,
      'LARGURA': produto.largura,
      'ALTURA': produto.altura,
      'COMPRIMENTO': produto.comprimento,
      'TAMANHO': produto.tamanho,
      'PESO LIQUIDO': produto.pesoLiquido,
      'GRUPO TRIBUTO': produto.grupoTributo,
      'IPI': produto.ipi,
      'GARANTIA (DIAS)': produto.garantiaDias,
      'SETOR': produto.setor,
      'CUSTO TOTAL': produto.custoTotal,
      'CUSTO MÉDIO': produto.custoMedio,
      'CUSTO PRODUÇÃO': produto.custoProducao,
      'URL ECOMMERCE': produto.urlEcommerce,
      'INFORMAÇÕES DO PRODUTO': produto.infoProduto,
      'PRODUTO SIMILAR': produto.produtoSimilar,
      'COD CEST': produto.codCest,
      'VALOR FRETE': produto.valorFrete,
      'CÓD. BENEFÍCIO': produto.codBeneficio
    })));

    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Produtos");

    XLSX.writeFile(workbook, "produtos.xlsx");
  }

  function importarExcel() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.xlsx,.xls,.csv';

    input.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = (event) => {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });

        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: '' });

        produtos.length = 0;
        jsonData.forEach(row => {
          const produto = {
            codBarra: row['COD BARRA'],
            codFabric: row['COD FABRIC'],
            descricao: row['DESCRIÇÃO'],
            un: row['UN'],
            disponivel: parseInt(row['DISPONÍVEL'], 10),
            preco: row['R$ PREÇO'],
            qtdeCompra: parseInt(row['QTDE COMPRA'], 10),
            dtInicioProm: row['DT INICIO PROM'],
            dtFimProm: row['DT FIM PROM'],
            pesoBruto: parseFloat(row['PESO BRUTO']),
            promocao: row['PROMOÇÃO'],
            suspenso: row['SUSPENSO'],
            comAVista: row['COM.A VISTA'],
            comAPrazo: row['COM.A PRAZO'],
            complemento: row['COMPLEMENTO'],
            grupo: row['GRUPO'],
            subgrupo: row['SUBGRUPO'],
            descricaoCompra: row['DESCRIÇÃO PARA COMPRA'],
            temEquiv: row['TEM EQUIV'],
            inativo: row['INATIVO'],
            letra: row['LETRA'],
            cFiscal: row['C. FISCAL'],
            classFiscal: row['CLASS.FISCAL'],
            dtCadastro: row['DT CADASTRO'],
            categoria: row['CATEGORIA'],
            cor: row['COR'],
            abc: row['ABC'],
            codProduto: row['COD PRODUTO'],
            cst: row['CST'],
            estoqueSeg: parseInt(row['ESTOQUE SEG'], 10),
            estoqueMin: parseInt(row['ESTOQUE MIN'], 10),
            dtUltAlteracao: row['DT ULT ALTERAÇÃO'],
            grupoImpostos: row['GRUPO IMPOSTOS'],
            tipo: row['TIPO'],
            observacao: row['OBSERVAÇÃO'],
            largura: parseFloat(row['LARGURA']),
            altura: parseFloat(row['ALTURA']),
            comprimento: parseFloat(row['COMPRIMENTO']),
            tamanho: row['TAMANHO'],
            pesoLiquido: parseFloat(row['PESO LIQUIDO']),
            grupoTributo: row['GRUPO TRIBUTO'],
            ipi: row['IPI'],
            garantiaDias: parseInt(row['GARANTIA (DIAS)'], 10),
            setor: row['SETOR'],
            custoTotal: parseFloat(row['CUSTO TOTAL']),
            custoMedio: parseFloat(row['CUSTO MÉDIO']),
            custoProducao: parseFloat(row['CUSTO PRODUÇÃO']),
            urlEcommerce: row['URL ECOMMERCE'],
            infoProduto: row['INFORMAÇÕES DO PRODUTO'],
            produtoSimilar: row['PRODUTO SIMILAR'],
            codCest: row['COD CEST'],
            valorFrete: parseFloat(row['VALOR FRETE']),
            codBeneficio: row['CÓD. BENEFÍCIO']
          };
          produtos.push(produto);
        });

        produtosFiltrados = [...produtos];
        renderizarTabela();
        alert('Importação concluída com sucesso!');
      };

      reader.readAsArrayBuffer(file);
    };

    input.click();
  }

  function ordenarTabela(coluna) {
    const ordem = coluna.dataset.ordem === 'asc' ? 'desc' : 'asc';
    coluna.dataset.ordem = ordem;
    const chave = coluna.textContent.toLowerCase().replace(' ', '');
    produtosFiltrados.sort((a, b) => {
      if (a[chave] < b[chave]) return ordem === 'asc' ? -1 : 1;
      if (a[chave] > b[chave]) return ordem === 'asc' ? 1 : -1;
      return 0;
    });
    renderizarTabela();
  }

  document.querySelectorAll('th').forEach(th => {
    th.onclick = () => ordenarTabela(th);
  });

  function confirmarExclusao() {
    if (produtosSelecionados.length > 0) {
      produtosSelecionados.forEach(produto => {
        const alteracao = {
          usuario: 'Usuário Atual', // Substitua pelo nome do usuário atual
          alteracao: `Excluiu produto ${produto.descricao}`,
          data: new Date().toLocaleDateString(),
          hora: new Date().toLocaleTimeString()
        };
        historicoAlteracoes.push(alteracao);
        const index = produtos.indexOf(produto);
        if (index > -1) {
          produtos.splice(index, 1);
        }
      });
      produtosFiltrados = [...produtos];
      produtosSelecionados = [];
      renderizarTabela();
      alert('Produtos excluídos com sucesso!');
      fecharModalExcluir();
    }
  }

  function alterarProduto() {
    if (produtosSelecionados.length > 0) {
      const produto = produtosSelecionados[0];
      document.getElementById('inputNome').value = produto.descricao;
      document.getElementById('inputQuantidade').value = produto.disponivel;
      document.getElementById('inputGrupo').value = produto.grupo;
      document.getElementById('inputSubgrupo').value = produto.subgrupo;
      document.getElementById('inputCategoria').value = produto.categoria;
      document.getElementById('inputUnidade').value = produto.un;
      document.getElementById('inputPrecoDetalhes').value = produto.preco;
      document.getElementById('inputSerialNumber').value = produto.serialNumber ? produto.serialNumber.toUpperCase() : '';
      document.getElementById('modalDetalhes').style.display = 'block';
    } else {
      alert('Selecione um produto para alterar.');
    }
  }

  function salvarAlteracoes() {
    if (produtosSelecionados.length > 0) {
      const produto = produtosSelecionados[0];
      const alteracao = {
        usuario: 'Usuário Atual', // Substitua pelo nome do usuário atual
        alteracao: `Alterou produto ${produto.descricao}`,
        data: new Date().toLocaleDateString(),
        hora: new Date().toLocaleTimeString()
      };
      historicoAlteracoes.push(alteracao);
      produto.descricao = document.getElementById('inputNome').value;
      produto.disponivel = parseInt(document.getElementById('inputQuantidade').value, 10);
      produto.grupo = document.getElementById('inputGrupo').value;
      produto.subgrupo = document.getElementById('inputSubgrupo').value;
      produto.categoria = document.getElementById('inputCategoria').value;
      produto.un = document.getElementById('inputUnidade').value;
      produto.preco = document.getElementById('inputPrecoDetalhes').value;
      produto.serialNumber = document.getElementById('inputSerialNumber').value.toUpperCase();
      fecharModal();
      renderizarTabela();
      alert('Alterações salvas com sucesso!');
    }
  }

  function abrirModalAdicionar() {
    document.getElementById('modalAdicionar').style.display = 'block';
  }

  function fecharModalAdicionar() {
    document.getElementById('modalAdicionar').style.display = 'none';
  }

  function adicionarProduto() {
    const codBarra = parseInt(document.getElementById('inputCodBarra').value, 10);
    const codFabric = document.getElementById('inputCodFabric').value;
    const codAuxiliar = document.getElementById('inputCodAuxiliar').value;
    const descricao = document.getElementById('inputDescricao').value;
    const un = document.getElementById('inputUnidadeAdicionar').value;
    const disponivel = parseInt(document.getElementById('inputDisponivelAdicionar').value, 10);
    const preco = document.getElementById('inputPreco').value;
    const serialNumber = document.getElementById('inputSerialNumberAdicionar').value.toUpperCase();
    const grupo = document.getElementById('inputGrupoAdicionar').value;
    const subgrupo = document.getElementById('inputSubgrupoAdicionar').value;
    const categoria = document.getElementById('inputCategoriaAdicionar').value;

    const produtoExistente = produtos.find(produto => produto.codBarra === codBarra && produto.codFabric === codFabric);
    if (produtoExistente) {
      alert('Produto com o mesmo código de barras e código de fabricante já existe.');
      return;
    }

    const novoProduto = { codBarra, codFabric, codAuxiliar, descricao, un, disponivel, preco, grupo, subgrupo, categoria, serialNumber };
    produtos.push(novoProduto);
    produtosFiltrados = [...produtos];
    fecharModalAdicionar();
    renderizarTabela();
    alert('Produto adicionado com sucesso!');
  }

  function excluirProduto() {
    if (produtosSelecionados.length > 0) {
      produtosSelecionados.forEach(produto => {
        const alteracao = {
          usuario: 'Usuário Atual', // Substitua pelo nome do usuário atual
          alteracao: `Excluiu produto ${produto.descricao}`,
          data: new Date().toLocaleDateString(),
          hora: new Date().toLocaleTimeString()
        };
        historicoAlteracoes.push(alteracao);
        const index = produtos.indexOf(produto);
        if (index > -1) {
          produtos.splice(index, 1);
        }
      });
      produtosFiltrados = [...produtos];
      produtosSelecionados = [];
      renderizarTabela();
      alert('Produtos excluídos com sucesso!');
    } else {
      alert('Selecione um produto para excluir.');
    }
  }

  function abrirModalExcluir() {
    if (produtosSelecionados.length > 0) {
      document.getElementById('modalExcluir').style.display = 'block';
    } else {
      alert('Selecione um produto para excluir.');
    }
  }

  function fecharModalExcluir() {
    document.getElementById('modalExcluir').style.display = 'none';
  }

  document.querySelectorAll('.filters input').forEach(input => {
    input.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        pesquisar();
      }
    });
  });

  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
  }

  function abrirModalHistorico() {
    const tabelaHistorico = document.getElementById('tabela-historico');
    tabelaHistorico.innerHTML = '';
    historicoAlteracoes.forEach(alteracao => {
      const linha = document.createElement('tr');
      linha.innerHTML = `
        <td>${alteracao.usuario}</td>
        <td>${alteracao.alteracao}</td>
        <td>${alteracao.data}</td>
        <td>${alteracao.hora}</td>
      `;
      tabelaHistorico.appendChild(linha);
    });
    document.getElementById('modalHistorico').style.display = 'block';
  }

  function fecharModalHistorico() {
    document.getElementById('modalHistorico').style.display = 'none';
  }

  function showTab(tabId) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
  }
</script>

</body>
</html>
